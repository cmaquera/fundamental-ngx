<ng-container *ngTemplateOutlet="mobile ? mobileView : desktopView"></ng-container>

<ng-template #mobileView>
    <ng-container *ngTemplateOutlet="controlTemplate"></ng-container>
</ng-template>

<ng-template #desktopView>
    <fd-popover
        [isOpen]="isOpen"
        (isOpenChange)="handleOpenChange($event)"
        [triggers]="[]"
        [placement]="placement"
        [closeOnEscapeKey]="true"
        [disabled]="disabled"
        [focusTrapped]="true"
    >
        <fd-popover-control>
            <ng-container *ngTemplateOutlet="controlTemplate"></ng-container>
        </fd-popover-control>
        <fd-popover-body [style.display]="'block'" [attr.aria-expanded]="isOpen" [attr.aria-hidden]="!isOpen">
            <ng-container *ngTemplateOutlet="datePickerTemplate"></ng-container>
        </fd-popover-body>
    </fd-popover>
</ng-template>

<ng-template #controlTemplate>
    <fd-input-group [compact]="compact" [state]="state" [disabled]="disabled">
        <input
            #datePicker
            class="fd-input"
            fd-input-group-input
            type="text"
            [attr.aria-label]="dateInputLabel"
            [(ngModel)]="inputFieldDate"
            [placeholder]="placeholder"
            (ngModelChange)="handleInputChange($event)"
            (click)="openCalendar()"
            [compact]="compact"
            [ngClass]="{ 'is-error': isInvalidDateInput && useValidation }"
        />
        <span fd-input-group-addon [button]="true" [compact]="compact">
                <button
                    fd-button
                    [attr.tabindex]="buttonFocusable ? 0 : -1"
                    [glyph]="'appointment-2'"
                    [fdType]="'transparent'"
                    [compact]="compact"
                    (click)="toggleCalendar()"
                    [attr.aria-label]="displayCalendarToggleLabel"
                    [attr.aria-expanded]="isOpen"
                ></button>
            </span>
    </fd-input-group>
</ng-template>

<ng-template #datePickerTemplate>
    <fd-calendar
        [activeView]="activeView"
        [compact]="compact"
        [markWeekends]="markWeekends"
        [specialDaysRules]="specialDaysRules"
        [showWeekNumbers]="showWeekNumbers"
        [aggregatedYearGrid]="aggregatedYearGrid"
        [yearGrid]="yearGrid"
        [calType]="type"
        [rangeHoverEffect]="rangeHoverEffect"
        [disableFunction]="disableFunction ? disableFunction : null"
        [disableRangeStartFunction]="disableRangeStartFunction ? disableRangeStartFunction : null"
        [disableRangeEndFunction]="disableRangeEndFunction ? disableRangeEndFunction : null"
        [selectedDate]="selectedDate"
        [startingDayOfWeek]="startingDayOfWeek"
        [selectedRangeDate]="selectedRangeDate"
        [mobileLandscape]="mobile && screenOrientation === fdScreenOrientation.LANDSCAPE"
        [mobilePortrait]="mobile && screenOrientation === fdScreenOrientation.PORTRAIT"
        (closeClicked)="handleOpenChange(false)"
        (closeCalendar)="closeFromCalendar()"
        (selectedRangeDateChange)="handleRangeDateChange($event)"
        (selectedDateChange)="handleSingleDateChange($event)"
        (activeViewChange)="handleCalendarActiveViewChange($event)"
    ></fd-calendar>
</ng-template>
